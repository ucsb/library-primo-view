---
name: "package files for production"
on:
  workflow_dispatch:
  push:
    branches:
    - main
jobs:
  package:
    name: "zip files using view id as folder name"
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repo
      uses: actions/checkout@v2
    - name: Read .env file
      id: getenv
      run: echo "file=$(cat .env)" >> $GITHUB_OUTPUT
    - name: Get view id from file
      env:
        CONTENT: ${{ steps.getenv.outputs.file }}
      id: view
      run: |
        view=$(echo $CONTENT | sed 's/VIEW="//;s/"//')
        echo "vid=$view" >> $GITHUB_OUTPUT
    - name: build image
      run: docker compose build
    - name: zip file
      env:
        VIEW: ${{ steps.view.outputs.id }}
      run: docker compose run primo gulp create-package --view $VIEW
    - name: upload package
      uses: actions/upload-artifact@v3
      with:
        name: ${{ steps.view.outputs.id }}
        path: bin/${{ steps.view.outputs.id }}.zip
...
